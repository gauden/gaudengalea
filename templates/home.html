{% extends "layout.html" %}

{% block title %}{{ site.name }}{% endblock %}

{% block body %}

  <h2>Gauden Galea</h2>

  {{ this.intro }}

  {# Collect recent items from /blog, /pub, /lab, /bio #}
  {% set section_paths = ['/blog', '/pub', '/lab', '/bio'] %}
  {% set items = [] %}

  {% for p in section_paths %}
    {% set sec = site.get(p) %}
    {% if sec %}
      {% for child in sec.children %}
        {% if child.pub_date %}{% set _ = items.append(child) %}{% endif %}
      {% endfor %}
    {% endif %}
  {% endfor %}

  {# Sort newest-first and take top N #}
  {% set posts = items|sort(attribute='pub_date', reverse=true) %}
  {% set posts = posts[:8] %}

  <ul>
    {% for post in posts %}
      {# Label by section, based on path prefix #}
      {% set label = 'Blog' %}
      {% if post.path.startswith('/pub/') %}
        {% set label = 'Pub' %}
      {% elif post.path.startswith('/lab/') %}
        {% set label = 'Lab' %}
      {% elif post.path.startswith('/bio/') %}
        {% set label = 'Bio' %}
      {% endif %}

      <li>
        <a href="{{ post|url }}">{{ post.title }}</a> 

        {% set excerpt = post.summary or (post.body|striptags) %}
        {% if excerpt %}
          <span class="marginnote">
          {{ label }}
          </span>
          <div class="summary">
             {{ excerpt|truncate(160, killwords=False, end='â€¦') }} <br>
              {{ post.pub_date|dateformat('d MMM YYYY') }} 
          </div>
        {% endif %}
      </li>
    {% else %}
      <li><em>No recent items found under /blog, /pub, /lab, or /bio.</em></li>
    {% endfor %}
  </ul>
  
{% endblock %}


